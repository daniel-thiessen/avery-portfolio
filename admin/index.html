<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avery Portfolio - Content Manager</title>
  <style>
    /* Status display styling */
    #login-status {
      padding: 20px;
      color: #333;
      background: #f7f7f7;
      border-radius: 4px;
      margin: 20px auto;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .spinner {
      width: 30px;
      height: 30px;
      margin: 10px auto;
      border: 3px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      border-top-color: #07d;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* Debug console */
    #debug-console {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #f5f5f5;
      border-top: 1px solid #ddd;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 1000;
      max-height: 30vh;
      overflow-y: auto;
      display: none;
    }

    #debug-console.visible {
      display: block;
    }

    #debug-log {
      height: 150px;
      overflow-y: auto;
      background: #fff;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 3px;
      margin-top: 10px;
    }

    #debug-log p {
      margin: 3px 0;
      padding: 2px 0;
      border-bottom: 1px solid #eee;
    }

    #debug-log p.error {
      color: #d32f2f;
    }

    #debug-log p.success {
      color: #388e3c;
    }

    /* Debug console toggle button */
    #debug-toggle {
      position: fixed;
      bottom: 0;
      right: 20px;
      background: #333;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px 4px 0 0;
      cursor: pointer;
      z-index: 1001;
    }

    button {
      background: #2d2d2d;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <!-- Login status indicator -->
  <div id="login-status">
    <h2>Content Manager</h2>
    <p>Initializing the content management system...</p>
    <div class="spinner"></div>
  </div>

  <!-- Debug toggle button -->
  <button id="debug-toggle">Debug Console</button>
  
  <!-- Debug console -->
  <div id="debug-console">
    <h3>Debug Console</h3>
    <button id="clear-log">Clear Log</button>
    <button id="test-api">Test GitHub API</button>
    <div id="debug-log"></div>
  </div>
  
  <!-- Load Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    // Debug console functionality
    (function setupDebugConsole() {
      const debugConsole = document.getElementById('debug-console');
      const debugToggle = document.getElementById('debug-toggle');
      const debugLog = document.getElementById('debug-log');
      const clearLogBtn = document.getElementById('clear-log');
      const testApiBtn = document.getElementById('test-api');
      
      // Toggle debug console
      debugToggle.addEventListener('click', () => {
        debugConsole.classList.toggle('visible');
        debugToggle.textContent = debugConsole.classList.contains('visible') 
          ? 'Hide Debug Console' 
          : 'Debug Console';
      });
      
      // Clear log
      clearLogBtn.addEventListener('click', () => {
        debugLog.innerHTML = '';
        log('Log cleared');
      });
      
      // Test GitHub API
      testApiBtn.addEventListener('click', async () => {
        try {
          log('Testing GitHub API access...');
          const response = await fetch('https://api.github.com/repos/daniel-thiessen/avery-portfolio');
          log(`GitHub API response: ${response.status}`);
          
          if (response.ok) {
            const data = await response.json();
            log(`Repository: ${data.full_name}, Default branch: ${data.default_branch}`, 'success');
          } else {
            log(`API error: ${response.statusText}`, 'error');
          }
        } catch (err) {
          log(`API test failed: ${err.message}`, 'error');
        }
      });
      
      // Global logging function
      window.log = function(message, type = 'info') {
        const entry = document.createElement('p');
        entry.className = type;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        debugLog.appendChild(entry);
        debugLog.scrollTop = debugLog.scrollHeight;
        console.log(`[${type}] ${message}`);
      };
      
      // Initial log entry
      log('Debug console initialized');
      log(`User agent: ${navigator.userAgent}`);
    })();
    
    // Initialize Decap CMS
    (function initCMS() {
      const statusDiv = document.getElementById('login-status');
      
      try {
        window.log('Initializing Decap CMS');
        
        // Most basic initialization - no event handlers, just initialize
        window.CMS.init();
        
        window.log('CMS initialized successfully');
      } catch (err) {
        window.log(`CMS initialization error: ${err.message}`, 'error');
        statusDiv.innerHTML = `
          <h2>Error</h2>
          <p>Failed to initialize content manager: ${err.message}</p>
        `;
      }
    })();
  </script>
</body>
</html>